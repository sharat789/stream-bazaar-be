<!DOCTYPE html>
<html>
  <head>
    <title>WebSocket Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
      }
      .section {
        border: 1px solid #ddd;
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
        cursor: pointer;
      }
      #logs {
        background: #f5f5f5;
        padding: 10px;
        height: 300px;
        overflow-y: scroll;
        font-family: monospace;
        font-size: 12px;
      }
      .log-entry {
        padding: 3px 0;
        border-bottom: 1px solid #eee;
      }
      input {
        padding: 8px;
        margin: 5px;
        width: 200px;
      }
    </style>
  </head>
  <body>
    <h1>üîå WebSocket Tester</h1>

    <div class="section">
      <h3>Connection Status: <span id="status">Disconnected</span></h3>
      <button id="connect">Connect</button>
      <button id="disconnect">Disconnect</button>
    </div>

    <div class="section">
      <h3>Session Controls</h3>
      <input
        type="text"
        id="sessionId"
        placeholder="Session ID"
        value="test-session-123"
      />
      <button id="joinSession">Join Session</button>
      <button id="leaveSession">Leave Session</button>
      <div>Current Viewer Count: <strong id="viewerCount">0</strong></div>
    </div>

    <div class="section">
      <h3>Send Reactions</h3>
      <button onclick="sendReaction('like')">üëç Like</button>
      <button onclick="sendReaction('love')">‚ù§Ô∏è Love</button>
      <button onclick="sendReaction('fire')">üî• Fire</button>
      <button onclick="sendReaction('clap')">üëè Clap</button>
    </div>

    <div class="section">
      <h3>Event Logs</h3>
      <button onclick="clearLogs()">Clear Logs</button>
      <div id="logs"></div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
      let socket = null;
      const statusEl = document.getElementById("status");
      const logsEl = document.getElementById("logs");
      const sessionIdInput = document.getElementById("sessionId");
      const viewerCountEl = document.getElementById("viewerCount");

      function log(message, type = "info") {
        const time = new Date().toLocaleTimeString();
        const color =
          type === "error" ? "red" : type === "success" ? "green" : "blue";
        logsEl.innerHTML += `<div class="log-entry" style="color: ${color}">[${time}] ${message}</div>`;
        logsEl.scrollTop = logsEl.scrollHeight;
      }

      function clearLogs() {
        logsEl.innerHTML = "";
      }

      document.getElementById("connect").onclick = () => {
        if (socket && socket.connected) {
          log("Already connected!", "error");
          return;
        }

        socket = io("http://localhost:3000"); // Change port if different

        socket.on("connect", () => {
          statusEl.textContent = "Connected ‚úÖ";
          statusEl.style.color = "green";
          log("Connected to server", "success");
        });

        socket.on("disconnect", () => {
          statusEl.textContent = "Disconnected ‚ùå";
          statusEl.style.color = "red";
          log("Disconnected from server", "error");
        });

        socket.on("viewer-count", (count) => {
          viewerCountEl.textContent = count;
          log(`Viewer count updated: ${count}`, "success");
        });

        socket.on("new-reaction", (data) => {
          log(
            `Reaction received: ${data.type} at ${new Date(
              data.timestamp
            ).toLocaleTimeString()}`,
            "success"
          );
        });

        socket.on("connect_error", (error) => {
          log(`Connection error: ${error.message}`, "error");
        });
      };

      document.getElementById("disconnect").onclick = () => {
        if (socket) {
          socket.disconnect();
          socket = null;
        }
      };

      document.getElementById("joinSession").onclick = () => {
        if (!socket || !socket.connected) {
          log("Not connected! Click Connect first.", "error");
          return;
        }
        const sessionId = sessionIdInput.value;
        socket.emit("join-session", sessionId);
        log(`Joining session: ${sessionId}`);
      };

      document.getElementById("leaveSession").onclick = () => {
        if (!socket || !socket.connected) {
          log("Not connected!", "error");
          return;
        }
        const sessionId = sessionIdInput.value;
        socket.emit("leave-session", sessionId);
        log(`Leaving session: ${sessionId}`);
      };

      function sendReaction(type) {
        if (!socket || !socket.connected) {
          log("Not connected!", "error");
          return;
        }
        const sessionId = sessionIdInput.value;
        socket.emit("send-reaction", { sessionId, type });
        log(`Sent reaction: ${type} to session ${sessionId}`);
      }
    </script>
  </body>
</html>
